<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的隨身筆記</title>
    <!-- 引入 Tailwind CSS (用於快速排版) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 React 和 ReactDOM (用於建構網頁邏輯) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- 引入 Babel (讓瀏覽器看懂 React 程式碼) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- 引入圖標庫 -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* 隱藏捲軸但保留功能，讓手機體驗更好 */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-gray-100 touch-pan-y">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            // 1. 設定狀態：這是我們的資料庫
            const [notes, setNotes] = useState([]);
            const [inputValue, setInputValue] = useState("");

            // 2. 初始化：網頁一打開，就去 localStorage 抓資料
            useEffect(() => {
                const savedNotes = localStorage.getItem("my-web-notes");
                if (savedNotes) {
                    setNotes(JSON.parse(savedNotes));
                }
            }, []);

            // 3. 儲存機制：只要 notes 有變動，就同步存到 localStorage
            useEffect(() => {
                localStorage.setItem("my-web-notes", JSON.stringify(notes));
            }, [notes]);

            // 新增筆記的功能
            const handleAddNote = () => {
                if (!inputValue.trim()) return; // 防止空白內容
                
                const newNote = {
                    id: Date.now(), // 用時間當作唯一 ID
                    text: inputValue,
                    date: new Date().toLocaleString('zh-TW', { hour12: false })
                };

                // 把新筆記放在最上面 (unshift 的概念)
                setNotes([newNote, ...notes]);
                setInputValue(""); // 清空輸入框
            };

            // 刪除筆記的功能
            const handleDeleteNote = (id) => {
                const isConfirmed = window.confirm("確定要刪除這條筆記嗎？");
                if (isConfirmed) {
                    const updatedNotes = notes.filter(note => note.id !== id);
                    setNotes(updatedNotes);
                }
            };

            return (
                <div className="min-h-screen flex flex-col max-w-md mx-auto bg-white shadow-xl min-h-screen relative">
                    {/* 標題區 */}
                    <div className="bg-indigo-600 p-5 pt-8 text-white shadow-md z-10 sticky top-0">
                        <h1 className="text-2xl font-bold flex items-center gap-2">
                            <i data-lucide="notebook-pen" className="w-6 h-6"></i>
                            隨身筆記 App
                        </h1>
                        <p className="text-indigo-200 text-sm mt-1">記錄您的想法，資料儲存於本機</p>
                    </div>

                    {/* 筆記列表區 */}
                    <div className="flex-1 overflow-y-auto p-4 space-y-3 pb-24 no-scrollbar">
                        {notes.length === 0 ? (
                            <div className="text-center text-gray-400 mt-20 flex flex-col items-center">
                                <i data-lucide="ghost" className="w-16 h-16 mb-4 opacity-50"></i>
                                <p>目前沒有筆記<br/>試著寫點什麼吧！</p>
                            </div>
                        ) : (
                            notes.map(note => (
                                <div key={note.id} className="bg-gray-50 border-l-4 border-indigo-500 p-4 rounded-r-lg shadow-sm animate-fade-in hover:bg-gray-100 transition-colors group">
                                    <div className="flex justify-between items-start">
                                        <p className="text-gray-800 whitespace-pre-wrap leading-relaxed flex-1">{note.text}</p>
                                        <button 
                                            onClick={() => handleDeleteNote(note.id)}
                                            className="text-gray-300 hover:text-red-500 p-1 ml-2 transition-colors"
                                            title="刪除"
                                        >
                                            <i data-lucide="trash-2" className="w-4 h-4"></i>
                                        </button>
                                    </div>
                                    <p className="text-xs text-gray-400 mt-3 text-right">{note.date}</p>
                                </div>
                            ))
                        )}
                    </div>

                    {/* 底部輸入區 */}
                    <div className="p-4 bg-white border-t border-gray-200 fixed bottom-0 w-full max-w-md pb-6 safe-area-bottom">
                        <div className="flex gap-2 items-end">
                            <textarea
                                value={inputValue}
                                onChange={(e) => setInputValue(e.target.value)}
                                placeholder="輸入內容..."
                                className="w-full bg-gray-100 text-gray-800 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none h-14 max-h-32 shadow-inner"
                                style={{minHeight: '3.5rem'}}
                            />
                            <button 
                                onClick={handleAddNote}
                                className={`p-3 rounded-full shadow-lg transition-all transform active:scale-95 flex-shrink-0 ${
                                    inputValue.trim() ? 'bg-indigo-600 text-white hover:bg-indigo-700' : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                }`}
                                disabled={!inputValue.trim()}
                            >
                                <i data-lucide="send-horizontal" className="w-6 h-6"></i>
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

        // 初始化圖標
        setTimeout(() => {
            lucide.createIcons();
        }, 100);
        
        // 每次渲染後更新圖標
        setInterval(() => {
            lucide.createIcons();
        }, 1000);
    </script>
</body>
</html>